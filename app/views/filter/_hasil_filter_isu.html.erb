<div class="card border-0 shadow">
  <div class="card-header">
    <div class="row align-items-center">
      <div class="col">
        <h2 class="fs-5 fw-bold mb-0">Isu dan Permasalahan</h2>
      </div>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table align-items-center">
      <thead class="thead-light">
        <tr>
          <th class="border-bottom" scope="col">No.</th>
          <th class="border-bottom" scope="col">Program Kegiatan</th>
          <th class="border-bottom" scope="col">Indikator</th>
          <th class="border-bottom" scope="col">Target</th>
          <th class="border-bottom" scope="col">Satuan</th>
          <th class="border-bottom" scope="col">Subkegiatan</th>
          <th class="border-bottom" scope="col">Indikator</th>
          <th class="border-bottom" scope="col">Target</th>
          <th class="border-bottom" scope="col">Satuan</th>
          <th class="border-bottom" scope="col">Permasalahan</th>
          <th class="border-bottom" scope="col">Isu Strategis</th>
          <th class="border-bottom text-center" scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        <% @program_kegiatans.each.with_index(1) do |(kode_program, program_kegiatans), no| %>
          <% rowspan_top = program_kegiatans.map { |pr| pr[:permasalahans].size }.sum %>
          <% rowspan = rowspan_top + program_kegiatans.size + 1 %>
          <% program = ProgramKegiatan.find_by(kode_program: kode_program) %>
          <tr>
            <td class="text-gray-900 fw-bolder" scope="row" rowspan="<%= rowspan %>"><%= no %></td>
            <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= rowspan %>">program -<%= program.nama_program %></td>
            <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= rowspan %>">indikator pro - <%= program.indikator_program %></td>
            <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= rowspan %>">target pro -<%= program.target_program %></td>
            <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= rowspan %>">satuan pro -<%= program.satuan_target_program %></td>
            <td class="p-0 m-0"></td>
            <td class="p-0 m-0"></td>
            <td class="p-0 m-0"></td>
            <td class="p-0 m-0"></td>
            <td class="p-0 m-0"></td>
            <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= rowspan %>">isu - <%= program.isu_strategis %></td>
            <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= rowspan %>">
              <%= link_to add_new_isu_dan_permasalahan_path(program),
              { remote: true, class: 'btn btn-tertiary text-light d-inline-flex align-items-center toggle-active',
                data: { 'bs-toggle': 'modal', 'bs-target': '#form-isu-strategis'} } do %>
                <i class="fas fa-pencil-alt text-success icon icon-xs me-2"></i>
                Edit Isu Strategis
              <% end %>
            </td>
          </tr>
          <% program_kegiatans.each.with_index(1) do |program_kegiatan, i| %>
            <tr>
              <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= program_kegiatan[:permasalahans].size + 1 %>">sub -<%= program_kegiatan[:subkegiatan] %></td>
              <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= program_kegiatan[:permasalahans].size + 1 %>">indik sub -<%= program_kegiatan[:indikator_sub] %></td>
              <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= program_kegiatan[:permasalahans].size + 1 %>">target sub -<%= program_kegiatan[:target_sub] %></td>
              <td class="text-gray-900 text-wrap border-start border-end" scope="row" rowspan="<%= program_kegiatan[:permasalahans].size + 1 %>">satuan sub -<%= program_kegiatan[:satuan_sub] %></td>
            </tr>
            <% program_kegiatan[:permasalahans].each do |permasalahan| %>
              <tr>
                <td class="text-wrap border-bottom border-start border-end" width="450px">
                  permasalahan - <%= permasalahan || '-' %>
              </td>
              </tr>
            <% end %>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
