<div class="card border-0 shadow">
  <div class="card-header">
    <div class="row align-items-center">
      <div class="col-8">
        <h2 class="fs-5 fw-bold mb-0">Renstra <%= @nama_opd %></h2>
      </div>
    </div>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table align-items-center" data-controller='form-modal' data-action='ajax-update@window->form-modal#updateTargetValue'>
        <% @program_kegiatans.each.with_index(1) do |program, nomor| %>
          <thead class="thead-program">
            <tr class="header-program">
              <th class="border" scope="col" rowspan="2">Kode Program</th>
              <th class="border" scope="col" rowspan="2">No.</th>
              <th class="border" scope="col" rowspan="2">Program</th>
              <th class="border" scope="col" rowspan="2">Indikator</th>
              <th class="border text-center" scope="col" colspan="3">2020</th>
              <th class="border text-center" scope="col" colspan="3">2021</th>
              <th class="border text-center" scope="col" colspan="3">2022</th>
              <th class="border text-center" scope="col" colspan="3">2023</th>
              <th class="border text-center" scope="col" colspan="3">2024</th>
              <th class="border" scope="col" rowspan="2">Aksi</th>
            </tr>
            <tr>
              <th class="border" scope="col">Target</th>
              <th class="border" scope="col">Satuan</th>
              <th class="border" scope="col">Pagu Indikatif</th>
              <th class="border" scope="col">Target</th>
              <th class="border" scope="col">Satuan</th>
              <th class="border" scope="col">Pagu Indikatif</th>
              <th class="border" scope="col">Target</th>
              <th class="border" scope="col">Satuan</th>
              <th class="border" scope="col">Pagu Indikatif</th>
              <th class="border" scope="col">Target</th>
              <th class="border" scope="col">Satuan</th>
              <th class="border" scope="col">Pagu Indikatif</th>
              <th class="border" scope="col">Target</th>
              <th class="border" scope="col">Satuan</th>
              <th class="border" scope="col">Pagu Indikatif</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-gray-900 text-wrap border"  ><%= program.kode_program %></td>
              <td class="text-gray-900 text-wrap border"  ><%= nomor %></td>
              <td class="text-gray-900 text-wrap border"  ><%= program.nama_program %></td>
              <td class="text-gray-900 text-wrap border"  ><%= program.indikator_program %></td>
              <% (2020..2024).each do |tahun| %>
                <% target_tahun = program.target_program_tahun(tahun: program.tahun, kode_program: program.kode_program) %>
                <% target = target_tahun[:target] %>
                <% satuan = target_tahun[:satuan] %>

                <td class="text-gray-900 text-wrap border"  ><%= target %></td>
                <td class="text-gray-900 text-wrap border"  ><%= satuan %></td>
                <td class="text-gray-900 text-wrap border"  >Rp. -</td>
              <% end %>
              <td class="text-gray-900 text-wrap border">
                <%= link_to edit_renstra_path(
                  program,
                  nama: program.nama_program,
                  kode: program.kode_program,
                  indikator: program.indikator_program,
                  satuan: program.satuan_target_program,
                  jenis: 'Renstra',
                  sub_jenis: 'Program'),
                  remote: true,
                  class: 'btn btn-green',
                  data: { controller: 'form-modal',
                          action: 'form-modal#appendForm',
                          form_modal_location_param: 'form-laporan-renstra-body',
                          bs_target: '#form-laporan-renstra',
                          bs_toggle: 'modal' } do %>
                          Edit
                        <% end %>
              </td>
            </tr>
          </tbody>
          <% program.kegiatans.each.with_index(1) do |kegiatan, no_giat| %>
            <thead class="thead-kegiatan">
              <tr>
                <th class="border" scope="col" rowspan="2">Kode Kegiatan</th>
                <th class="border" scope="col" rowspan="2">No</th>
                <th class="border" scope="col" rowspan="2">Nama Kegiatan</th>
                <th class="border" scope="col" rowspan="2">Indikator</th>
                <th class="border text-center" scope="col" colspan="3">2020</th>
                <th class="border text-center" scope="col" colspan="3">2021</th>
                <th class="border text-center" scope="col" colspan="3">2022</th>
                <th class="border text-center" scope="col" colspan="3">2023</th>
                <th class="border text-center" scope="col" colspan="3">2024</th>
                <th class="border" scope="col" rowspan="2">Aksi</th>
              </tr>
              <tr>
                <th class="border" scope="col">Target</th>
                <th class="border" scope="col">Satuan</th>
                <th class="border" scope="col">Pagu Indikatif</th>
                <th class="border" scope="col">Target</th>
                <th class="border" scope="col">Satuan</th>
                <th class="border" scope="col">Pagu Indikatif</th>
                <th class="border" scope="col">Target</th>
                <th class="border" scope="col">Satuan</th>
                <th class="border" scope="col">Pagu Indikatif</th>
                <th class="border" scope="col">Target</th>
                <th class="border" scope="col">Satuan</th>
                <th class="border" scope="col">Pagu Indikatif</th>
                <th class="border" scope="col">Target</th>
                <th class="border" scope="col">Satuan</th>
                <th class="border" scope="col">Pagu Indikatif</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-gray-900 text-wrap border"  ><%= kegiatan.kode_giat %></td>
                <td class="text-gray-900 text-wrap border"  ><%= no_giat %></td>
                <td class="text-gray-900 text-wrap border"  ><%= kegiatan.nama_kegiatan %></td>
                <td class="text-gray-900 text-wrap border"  ><%= kegiatan.indikator_kinerja %></td>
                <% (2020..2024).each do |tahun_giat| %>
                  <% target_tahun = kegiatan.target_kegiatan_tahun(tahun: kegiatan.tahun, kode_giat: kegiatan.kode_giat) %>
                  <% target = target_tahun[:target] %>
                  <% satuan = target_tahun[:satuan] %>

                  <td class="text-gray-900 text-wrap border"  ><%= target %></td>
                  <td class="text-gray-900 text-wrap border"  ><%= satuan %></td>
                  <td class="text-gray-900 text-wrap border"  >Rp. -</td>
                <% end %>
                <td class="text-gray-900 text-wrap border">
                  <%= link_to edit_renstra_path(
                    kegiatan,
                    nama: kegiatan.nama_kegiatan,
                    kode: kegiatan.kode_giat,
                    indikator: kegiatan.indikator_kinerja,
                    satuan: kegiatan.satuan,
                    jenis: 'Renstra',
                    sub_jenis: 'Kegiatan'),
                    remote: true,
                    class: 'btn btn-green',
                    data: { controller: 'form-modal',
                            action: 'form-modal#appendForm',
                            form_modal_location_param: 'form-laporan-renstra-body',
                            bs_target: '#form-laporan-renstra',
                            bs_toggle: 'modal' } do %>
                            Edit
                          <% end %>
                </td>
              </tr>
            </tbody>
            <thead class="thead-subkegiatan">
              <tr>
                <th class="border" scope="col" rowspan="2">Kode Subkegiatan</th>
                <th class="border" scope="col" rowspan="2">No</th>
                <th class="border" scope="col" rowspan="2">Nama Subkegiatan</th>
                <th class="border" scope="col" rowspan="2">Indikator</th>
                <% (2020..2024).each do |tahun| %>
                  <th class="border text-center" scope="col" colspan="3"><%= tahun %></th>
                <% end %>
                <th class="border" scope="col" rowspan="2">Aksi</th>
              </tr>
              <tr class="sub-table-subkegiatans">
                <% (2020..2024).each do %>
                  <th class="border" scope="col" width="50px">Target</th>
                  <th class="border" scope="col">Satuan</th>
                  <th class="border" scope="col">Pagu Indikatif</th>
                <% end %>
              </tr>
            </thead>
            <tbody>
              <% kegiatan.subkegiatans.each.with_index(1) do |subgiat, no_subgiat| %>
                <tr>
                  <td class="text-gray-900 text-wrap border"  ><%= subgiat.kode_sub_giat %></td>
                  <td class="text-gray-900 text-wrap border"  ><%= no_subgiat %></td>
                  <td class="text-gray-900 text-wrap border"  ><%= subgiat.nama_subkegiatan %></td>
                  <td class="text-gray-900 text-wrap border"  ><%= subgiat.indikator_subkegiatan %></td>
                  <% (2020..2024).each do |tahun_sub| %>
                    <% target_tahun = subgiat.target_subkegiatan_tahun(tahun: subgiat.tahun, kode_sub_giat: subgiat.kode_sub_giat) %>
                    <% target = target_tahun[:target] %>
                    <% satuan = target_tahun[:satuan] %>

                    <td class="text-gray-900 text-wrap border"  ><%= target %></td>
                    <td class="text-gray-900 text-wrap border"  ><%= satuan %></td>
                    <td class="text-gray-900 text-wrap border"  >Rp. -</td>
                  <% end %>
                  <td class="text-gray-900 text-wrap border">
                    <%= link_to edit_renstra_path(
                      subgiat,
                      nama: subgiat.nama_subkegiatan,
                      kode: subgiat.kode_sub_giat,
                      indikator: subgiat.indikator_subkegiatan,
                      satuan: subgiat.satuan_target_subkegiatan,
                      jenis: 'Renstra',
                      sub_jenis: 'Subkegiatan'),
                      remote: true, class: 'btn btn-green',
                      data: { controller: 'form-modal',
                              action: 'form-modal#appendForm',
                              form_modal_location_param: 'form-laporan-renstra-body',
                              bs_target: '#form-laporan-renstra',
                              bs_toggle: 'modal' } do %>
                              Edit
                            <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          <% end %>
        <% end %>
      </table>
    </div>
  </div>
</div>
