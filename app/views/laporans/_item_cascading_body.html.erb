<div class="pohon-body">
  <table class="table table-bordered mb-3">
    <% unless pohon.exists? %>
      <tr>
        <td class="text-start"><%= pohon.title_up %></td>
        <td class="text-wrap text-start" colspan="2"><%= pohon.pohonable.strategi %></td>
      </tr>
      <% pohon.pelaksana.each.with_index(1) do |dibagikan, no| %>
        <tr>
          <td class="text-start">Pelaksana
            <% if pohon.pelaksana.size > 1 %>
              - <%= no %>
            <% end %>
          </td>
          <td class="text-wrap text-start" colspan="2"><%= dibagikan.dibagikan_ke %></td>
          <% if pohon.role == 'eselon_4' %>
            <% rekins = rekin_user(pohon.rencana_kinerjas, dibagikan.user_id)  %>
            <% rekins.each do |subkegiatan, sasarans| %>
              <% unless dibagikan.user.has_role?(:staff) %>
                <tr>
                  <td class="text-start">Subkegiatan</td>
                  <td class="text-wrap text-start" colspan="2"><%= subkegiatan&.nama_subkegiatan || 'Belum terisi' %></td>
                </tr>
                <tr>
                  <td class="text-start">Pagu</td>
                  <td class="text-wrap text-start">Rp. <%=  number_with_delimiter(pagu_sub_rekin(sasarans)) %></td>
                </tr>
                <tr>
                  <% indikator_sub = indikator_sub_rekin(@tahun, @opd, subkegiatan) %>
                  <td class="text-wrap text-start">Indikator</td>
                  <td class="text-wrap text-start" colspan="2"><%= indikator_sub.dig(:indikator) %></td>
                </tr>
                <tr>
                  <td class="text-wrap text-start">Target / Satuan</td>
                  <td class="text-wrap text-start" colspan="2"><%= indikator_sub.dig(:target) %> <%= indikator_sub.dig(:satuan) %></td>
                </tr>
              <% end %>
              <% sasarans.each.with_index(1) do |sasaran, no_s| %>
                <tr>
                  <td class="text-start">Rencana Kinerja
                    <% if sasarans.size > 1 %>
                      - <%= no_s %>
                    <% end %>
                  </td>
                  <td class="text-wrap text-start"><%= sasaran %> <%= sasaran.user %></td>
                </tr>
                <tr>
                  <td class="text-start">Anggaran</td>
                  <td class="rankir-2 text-start" colspan="2">Rp. <%= number_with_delimiter(sasaran.total_anggaran) %></td>
                </tr>
                <% sasaran.indikator_sasarans.each do |ind| %>
                  <tr>
                    <td class="text-wrap text-start">Indikator</td>
                    <td class="text-wrap text-start" colspan="2"><%= ind %></td>
                  </tr>
                  <tr>
                    <td class="text-wrap text-start">Target / Satuan</td>
                    <td class="text-wrap text-start" colspan="2"><%= ind.target_dan_satuan %></td>
                  </tr>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        </tr>
      <% end %>
      <% pohon.indikators.each.with_index(1) do |indikator, i| %>
        <tr class="detail d-none">
          <td class="text-start">Indikator
            <% if pohon.indikators.size > 1 %>
              <%= i %>
            <% end %>
          </td>
          <td class="text-wrap text-start" colspan="2"><%= indikator %></td>
        </tr>
        <tr class="detail d-none">
          <td class="text-start">Target / Satuan</td>
          <td class="text-wrap text-start" colspan="2"><%= indikator.target %> <%= indikator.satuan %></td>
        </tr>
      <% end %>
      <tr class="detail d-none">
        <td class="text-start">Keterangan</td>
        <td class="text-wrap text-start" colspan="2"><%= pohon.keterangan %></td>
      </tr>
      <tr class="detail d-none">
        <td class="text-start">Perangkat Daerah</td>
        <td class="text-wrap text-start" colspan="2"><%= pohon.pohonable.opd %></td>
      </tr>
      <% if pohon.processed? %>
        <tr class="detail <%= pohon.status %> d-none">
        </tr>
        <tr class="detail <%= pohon.status %> d-none">
          <td class="text-start"><%= pohon.status_ket %> oleh</td>
          <td class="text-wrap text-start" colspan="2"><%= pohon.diproses_oleh %></td>
        </tr>
        <tr class="detail <%= pohon.status %> d-none">
          <td class="text-start"><%= pohon.status_ket %> pada</td>
          <td class="text-wrap text-start" colspan="2"><%= time_tag(pohon.diproses_pada, format: :hari_jam) %></td>
        </tr>
        <% if pohon.status_ket == 'Ditolak' %>
          <tr class="detail <%= pohon.status %> d-none">
            <td class="text-start">Keterangan</td>
            <td class="text-wrap text-start" colspan="2"><%= pohon.keterangan_proses %></td>
          </tr>
        <% end %>
      <% end %>
    <% end %>
  </table>
  <button type="button" class="btn btn-outline-primary w-100" data-action="pohon-tematik#toggleDetail" data-pohon-tematik-show-param="false">Detail</button>
</div>
