<div class="card border-2 shadow mb-3">
  <% programKegiatan.sasarans.order(:created_at).each.with_index(1) do |sasaran, i| %>
    <% jumlah_target = sasaran.tahapans.sum :jumlah_target %>
    <% jumlah_realisasi = sasaran.tahapans.sum :jumlah_realisasi %>
      <div class="card-body">
        <div class="table-responsive">
        <h5>Sasaran <%= i %> : <%= sasaran.sasaran_kinerja %></h5>
          <% if sasaran.tahapans.any? %>
            <table class="table table-sm align-items-center table-flush">
              <thead class="thead-light">
                <tr>
                  <th class="border-bottom border-end border-start" scope="col" rowspan="2">No.</th>
                  <th class="border-bottom border-end" scope="col" rowspan="2">Tahapan Kerja</th>
                  <% (1..12).each do |i| %>
                    <th class="border-bottom border-end text-center" colspan="2" scope="col"><%= i %></th>
                  <% end %>
                  <th class="border-bottom border-end text-center" colspan="2" scope="col">Jumlah</th>
                  <th class="border-bottom border-end" scope="col" rowspan="2">Keterangan</th>
                </tr>
                <tr>
                  <% (1..13).each do |item| %>
                    <td class="border border-gray-900 bg-tertiary text-center text-gray-300" scope="col">T</td>
                    <td class="border border-gray-900 bg-info text-center text-gray-300" scope="col">R</td>
                  <% end %>
                </tr>
              </thead>
              <tbody>
                <% sasaran.tahapans.order(:created_at).each.with_index(1) do |tahapan, i| %>
                  <% aksi = tahapan.aksis %>
                  <tr>
                    <td class="text-gray-900 fw-bolder border-start border-end" scope="row"><%= i %></td>
                    <td class="text-gray-900"><%= tahapan.tahapan_kerja %></td>
                    <!-- Loop Tanggal-->
                    <% (1..12).each do |i| %>
                      <!-- FIXME kotor sekali disni, DRY this up-->
                      <td class="fw-bolder text-gray-500 border">
                        <%= aksi.find_by(bulan: i) ? aksi.find_by(bulan: i).target : '-' %>
                      </td>
                      <td class="fw-bolder text-gray-500 border">
                        <% if aksi.find_by(bulan: i) %>
                          <%= aksi.find_by(bulan: i).realisasi ? aksi.find_by(bulan: i).realisasi : '-' %>
                        <% else %>
                          -
                        <% end %>
                      </td>
                    <% end %>
                    <!-- Sum -->
                    <td class="fw-bolder text-gray-500 border"><%= tahapan.jumlah_target or '-'  %></td>
                    <td class="fw-bolder text-gray-500 border"><%= tahapan.jumlah_realisasi or '-' %></td>
                    <td class="fw-bolder text-gray-500 border"><%= tahapan.keterangan  %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <p class="text-danger">Belum Ada Tahapan</p>
          <% end %>
        </div>
      </div>
  <% end %>
</div>