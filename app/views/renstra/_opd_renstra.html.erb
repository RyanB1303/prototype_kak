<thead>
  <tr class="header-bidang-urusan">
    <th class="border" scope="col" rowspan="2" colspan="2">Kode OPD</th>
    <th class="border" scope="col" rowspan="2" colspan="3">Nama OPD</th>
    <% @periode.each do |tahun| %>
      <th class="border text-center" scope="col" colspan="8"><%= tahun %></th>
    <% end %>
  </tr>
  <tr>
    <% @periode.each do %>
      <th class="border" scope="col" colspan="5"></th>
      <th class="border" scope="col">Pagu Indikatif</th>
      <th class="border" scope="col" colspan="2">Realisasi</th>
    <% end %>
  </tr>
</thead>
<tbody>
  <td class="border" scope="col" colspan="2"><%= @opd.kode_unik_opd %></td>
  <td class="border" scope="col" colspan="3"><%= @opd.nama_opd %></td>
  <% @periode.each do |tahun| %>
    <td class="border" scope="col" colspan="5"></td>
    <% pagu_opd = Indikator.where(jenis: 'Renstra',
                                  sub_jenis: 'Subkegiatan',
                                  kode_opd: @opd.kode_unik_opd,
                                  tahun: tahun)
                                  .group_by(&:kode)
                                  .map { |_k, v| v.max_by(&:version) }
                                  .inject(0) { |inj, pagu| inj + pagu.pagu.to_i }
    %>
    <% realisasi_pagu_opd = Indikator.where(jenis: 'Renstra',
                                  sub_jenis: 'Subkegiatan',
                                  kode_opd: @opd.kode_unik_opd,
                                  tahun: tahun)
                                  .group_by(&:kode)
                                  .map { |_k, v| v.max_by(&:version) }
                                  .inject(0) { |inj, pagu| inj + pagu.realisasi_pagu.to_i }
    %>
    <td class="fw-bolder text-gray-900 text-wrap border" style="font-size: larger;">Rp. <%= number_with_delimiter(pagu_opd) %></td>
    <td class="fw-bolder text-gray-900 text-wrap border" style="font-size: larger;" colspan="2">Rp. <%= number_with_delimiter(realisasi_pagu_opd) %></td>
  <% end %>
</tbody>
