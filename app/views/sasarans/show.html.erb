<p id="notice"><%= notice %></p>
<h2>User : <%= @sasaran.user.nama %></h2>
<h2>NIK : <%= link_to @sasaran.user.nik, user_path(@sasaran.user) %></h2>
<hr>
<% unless @sasaran.program_kegiatan %>
<h3>Tambah Sub Kegiatan</h3>
<% program = ProgramKegiatan.all %>
<%= form_with(model: @sasaran, local: true) do |form| %>
  <div class="field">
    <% options = options_from_collection_for_select(program, 'id', 'nama_subkegiatan') %>
    <%= form.label :program_kegiatan_id, 'Sub Kegiatan : ' %>
    <%= form.select :program_kegiatan_id, options %>
  </div>
   <div class="actions">
    <%= form.submit %>
  </div>
  <% end %>
<% else %>
<p>
  <strong>Sub Kegiatan :</strong>
  <%= link_to @sasaran.program_kegiatan.nama_subkegiatan, program_kegiatan_path(@sasaran.program_kegiatan) %>
</p>
<% end %>
<hr>
<p>
  <strong>Sasaran kinerja:</strong>
  <%= @sasaran.sasaran_kinerja %>
</p>

<p>
  <strong>Indikator kinerja:</strong>
  <%= @sasaran.indikator_kinerja %>
</p>

<p>
  <strong>Target:</strong>
  <%= @sasaran.target %>
</p>

<p>
  <strong>Satuan:</strong>
  <%= @sasaran.satuan %>
</p>

<p>
  <strong>Penerima manfaat:</strong>
  <%= @sasaran.penerima_manfaat %>
</p>

<% unless @sasaran.rincian %>
<p>
  <strong>Harap isi Rincian Sasaran</strong>
  <hr>
  <%= render 'rincians/form', rincian: @sasaran.build_rincian %>
</p>
<% else %>
  <p>
    <strong>Data Terpilah :</strong>
    <%= @sasaran.rincian.data_terpilah %>
  </p>
<!-- NOTE : Refactor -->
  <p>
    <strong>Penyebab Internal :</strong>
    <%= @sasaran.rincian.penyebab_internal %>
  </p>
  <p>
    <strong>Penyebab External :</strong>
    <%= @sasaran.rincian.penyebab_external %>
  </p>
  
  <p>
    <strong>Permasalahan Umum :</strong>
    <%= @sasaran.rincian.permasalahan_umum %>
  </p>
  <p>
    <strong>Permasalahan Gender :</strong>
    <%= @sasaran.rincian.permasalahan_gender %>
  </p>

  <p>
    <strong>Resiko</strong>
    <%= @sasaran.rincian.resiko  %>
  </p>

  <p>
    <strong>Lokasi Pelaksanaan</strong>
    <%= @sasaran.rincian.lokasi_pelaksanaan  %>
  </p>

  <% unless @sasaran.rincian.tahapans.any? %>
    <%= link_to 'Tambah Renaksi', new_rincian_tahapan_path(@sasaran.rincian) %>
  <% else %>
  <hr>
    <h3>Rencana Aksi ( Tahapan pelaksaanaan ) </h3>
    <%= link_to 'Tambah Renaksi', new_rincian_tahapan_path(@sasaran.rincian) %>
      <hr>
      <table class="renaksi">
      <thead>
      <tr>
        <th rowspan="2">No</th>
        <th rowspan="2">Tahapan Kerja</th>
        <th colspan="2">1</th>
        <th colspan="2">2</th>
        <th colspan="2">3</th>
        <th colspan="2">4</th>
        <th colspan="2">5</th>
        <th colspan="2">6</th>
        <th colspan="2">7</th>
        <th colspan="2">8</th>
        <th colspan="2">9</th>
        <th colspan="2">10</th>
        <th colspan="2">11</th>
        <th colspan="2">12</th>
        <th colspan="2">Jumlah</th>
        <th rowspan="2">Keterangan</th>
      </tr>
      <tr>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
        <td>T</td>
        <td>R</td>
      </tr>
      </thead>
      <tbody>
    <% @sasaran.rincian.tahapans.each.with_index(1) do |tahapan, index| %>
        <tr>
          <td><%= index %></td>
          <td><%= tahapan.tahapan_kerja %></td>
          <!-- 1-->
          <td><%= tahapan.target if tahapan.bulan == "1"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "1"  %></td>
          <!-- 1-->
          <td><%= tahapan.target if tahapan.bulan == "2"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "2"  %></td>
          <!-- 1-->
          <td><%= tahapan.target if tahapan.bulan == "3"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "3"  %></td>
          <!-- 1-->
          <td><%= tahapan.target if tahapan.bulan == "4"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "4"  %></td>
          <!-- 1-->
          <td><%= tahapan.target if tahapan.bulan == "5"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "5"  %></td>
          <!-- 1-->
          <td><%= tahapan.target if tahapan.bulan == "6"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "6"  %></td>
          <!-- 1-->
          <td><%= tahapan.target if tahapan.bulan == "7"  %></td>
          <td><%= tahapan.realisasi if tahapan.bulan == "7" %></td>
          <!-- 1-->
          <td><%= tahapan.target if tahapan.bulan == "8"  %></td>
          <td><%= tahapan.realisasi if tahapan.bulan == "8"  %></td>
          <!-- 9 -->
          <td><%= tahapan.target if tahapan.bulan == "9"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "9"  %></td>
          <!--10 -->
          <td><%= tahapan.target if tahapan.bulan == "10"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "10"  %></td>
          <!-- 11 -->
          <td><%= tahapan.target if tahapan.bulan == "11"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "11"  %></td>
          <!-- 12-->
          <td><%= tahapan.target if tahapan.bulan == "12"  %></td>
          <td><%= tahapan.target if tahapan.bulan == "12"  %></td>
          <!-- Sum -->
          <td><%= tahapan.target  %></td>
          <td><%= tahapan.realisasi %></td>
          <td><%= tahapan.id  %></td>
        </tr>
    <% end %>

      </tbody>
      
      </table>
    
      <hr>

  <% end %>
  <!-- TODO: Add ajax to inline form -->
  <% unless @sasaran.pagus.any? %>
    <%= link_to 'Tambah Pagu', new_sasaran_pagu_path(@sasaran) %>

  <% else %>
    <hr>
    <h3>Pagu  <span>
    <h3>Pagu Total : <%= number_with_delimiter(@sasaran.pagus.sum(:total) , :delimiter => ',') %></h3>
    <%= link_to 'Tambah Pagu', new_sasaran_pagu_path(@sasaran) %>
    </span></h3>
   
    <% @sasaran.pagus.each do |pagu| %>
    <hr>
      <p>
        <strong>Item: </strong>
        <%= pagu.item %>
      </p>
      <p>
        <strong>Uang: </strong>
        <%= number_with_delimiter pagu.uang, :delimiter => ',' %>
      </p>
       <p>
        <strong>Satuan: </strong>
        <%= pagu.satuan %>
      </p>
       <p>
        <strong>Volume: </strong>
        <%= pagu.volume %>
      </p>
      <p>
        <strong>Total :</strong>
        <%= pagu.total %>
      </p>
      <p>
        <%= link_to 'Edit', edit_sasaran_pagu_path(@sasaran, pagu) %>
        <%= link_to 'Delete', sasaran_pagu_path(@sasaran, pagu), method: :delete, data: { confirm: "Hapus Pagu #{pagu.item} ?" } %>
      </p>
      <hr>
    <% end %>
  <% end %>
  

<% end %>


